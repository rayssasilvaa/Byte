generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* =========================
   PRODUTO
========================= */
model Product {
  id        Int        @id @default(autoincrement())
  name      String
  price     Float
  createdAt DateTime   @default(now())

  items     SaleItem[]
}

/* =========================
   VENDA
========================= */
model Sale {
  id         Int        @id @default(autoincrement())
  saleNumber Int
  status     SaleStatus @default(OPEN)
  total      Float?
  date       DateTime   @default(now())

  items      SaleItem[]
  payments   SalePayment[]

  @@index([date])
}

/* =========================
   ITENS DA VENDA
========================= */
model SaleItem {
  id        Int      @id @default(autoincrement())
  quantity  Int
  price     Float

  product   Product @relation(fields: [productId], references: [id])
  productId Int

  sale      Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)
  saleId    Int
}

/* =========================
   PAGAMENTOS
========================= */
model SalePayment {
  id     Int    @id @default(autoincrement())
  method String
  amount Float

  sale   Sale   @relation(fields: [saleId], references: [id], onDelete: Cascade)
  saleId Int
}

enum SaleStatus {
  OPEN
  CLOSED
}

/* =========================
   RESUMO MENSAL
========================= */
model MonthlySale {
  id    Int      @id @default(autoincrement())
  date  DateTime
  total Float

  @@unique([date])
}
